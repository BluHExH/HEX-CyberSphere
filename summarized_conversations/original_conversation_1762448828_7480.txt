{'role': 'assistant', 'content': '<function_calls>\n<create-file file_path="HEX-CyberSphere/core_engine/automation_manager.py">\n"""\nHEX-CyberSphere Automation Manager\nMain controller for automation workflows\n"""\n\nimport json\nimport logging\nimport sqlite3\nimport time\nfrom datetime import datetime\nfrom typing import Dict, Any\nimport requests\nfrom ai_controller import AIFramework\nfrom data_parser import DataParser\nfrom security_scanner import SecurityScanner\nfrom notifier import NotificationManager\n\nclass AutomationManager:\n    def __init__(self, config_path="../config/config.json"):\n        self.logger = self._setup_logger()\n        self.config = self._load_config(config_path)\n        self.db_connection = self._setup_database()\n        self.ai_framework = AIFramework()\n        self.data_parser = DataParser()\n        self.security_scanner = SecurityScanner()\n        self.notifier = NotificationManager()\n        \n        self.logger.info("Automation Manager initialized")\n    \n    def _setup_logger(self):\n        """Setup logging configuration"""\n        logging.basicConfig(\n            level=logging.INFO,\n            format=\'%(asctime)s - %(name)s - %(levelname)s - %(message)s\',\n            handlers=[\n                logging.FileHandler(\'../logs/automation_manager.log\'),\n                logging.StreamHandler()\n            ]\n        )\n        return logging.getLogger(__name__)\n    \n    def _load_config(self, config_path: str) -> Dict[Any, Any]:\n        """Load configuration from JSON file"""\n        try:\n            with open(config_path, \'r\') as f:\n                return json.load(f)\n        except Exception as e:\n            self.logger.error(f"Failed to load config: {e}")\n            return {}\n    \n    def _setup_database(self):\n        """Setup database connection"""\n        try:\n            conn = sqlite3.connect(\'../database/hex_data.db\')\n            return conn\n        except Exception as e:\n            self.logger.error(f"Failed to connect to database: {e}")\n            return None\n    \n    def execute_task(self, task_name: str, task_params: Dict[Any, Any]) -> Dict[Any, Any]:\n        """Execute an automation task"""\n        self.logger.info(f"Executing task: {task_name}")\n        \n        try:\n            # Log task execution\n            self._log_event(\'task_execution\', \'automation_manager\', \n                           f"Executing task: {task_name}")\n            \n            # Task routing based on name\n            if task_name == "ai_process":\n                result = self._execute_ai_task(task_params)\n            elif task_name == "security_scan":\n                result = self._execute_security_task(task_params)\n            elif task_name == "data_parse":\n                result = self._execute_parsing_task(task_params)\n            elif task_name == "web_automation":\n                result = self._execute_web_task(task_params)\n            else:\n                result = {"error": f"Unknown task: {task_name}"}\n            \n            # Log result\n            self._log_event(\'task_result\', \'automation_manager\', \n                           f"Task {task_name} completed: {json.dumps(result)}")\n            \n            return result\n        except Exception as e:\n            error_msg = f"Task execution failed: {str(e)}"\n            self.logger.error(error_msg)\n            self._log_event(\'task_error\', \'automation_manager\', error_msg)\n            return {"error": error_msg}\n    \n    def _execute_ai_task(self, params: Dict[Any, Any]) -> Dict[Any, Any]:\n        """Execute AI processing task"""\n        self.logger.info("Executing AI processing task")\n        \n        try:\n            data = params.get(\'data\', {})\n            operation = params.get(\'operation\', \'process\')\n            \n            if operation == \'process\':\n                result = self.ai_framework.process_data(data)\n            elif operation == \'anomaly_detect\':\n                result = self.ai_framework.detect_anomalies(data)\n            elif operation == \'predict_trends\':\n                result = self.ai_framework.predict_trends(data)\n            else:\n                result = {"error": f"Unknown AI operation: {operation}"}\n            \n            return result\n        except Exception as e:\n            error_msg = f"AI task execution failed: {str(e)}"\n            self.logger.error(error_msg)\n            return {"error": error_msg}\n    \n    def _execute_security_task(self, params: Dict[Any, Any]) -> Dict[Any, Any]:\n        """Execute security scanning task"""\n        self.logger.info("Executing security scanning task")\n        \n        try:\n            target = params.get(\'target\', \'localhost\')\n            scan_type = params.get(\'scan_type\', \'basic\')\n            \n            if scan_type == \'port_scan\':\n                result = self.security_scanner.scan_ports(target)\n            elif scan_type == \'vulnerability_scan\':\n                result = self.security_scanner.scan_vulnerabilities(target)\n            elif scan_type == \'full_scan\':\n                result = self.security_scanner.full_scan(target)\n            else:\n                result = {"error": f"Unknown scan type: {scan_type}"}\n            \n            return result\n        except Exception as e:\n            error_msg = f"Security task execution failed: {str(e)}"\n            self.logger.error(error_msg)\n            return {"error": error_msg}\n    \n    def _execute_parsing_task(self, params: Dict[Any, Any]) -> Dict[Any, Any]:\n        """Execute data parsing task"""\n        self.logger.info("Executing data parsing task")\n        \n        try:\n            data = params.get(\'data\', \'\')\n            format_type = params.get(\'format\', \'json\')\n            \n            if format_type == \'json\':\n                result = self.data_parser.parse_json(data)\n            elif format_type == \'yaml\':\n                result = self.data_parser.parse_yaml(data)\n            elif format_type == \'csv\':\n                result = self.data_parser.parse_csv(data)\n            elif format_type == \'xml\':\n                result = self.data_parser.parse_xml(data)\n            else:\n                result = {"error": f"Unknown format type: {format_type}"}\n            \n            return result\n        except Exception as e:\n            error_msg = f"Parsing task execution failed: {str(e)}"\n            self.logger.error(error_msg)\n            return {"error": error_msg}\n    \n    def _execute_web_task(self, params: Dict[Any, Any]) -> Dict[Any, Any]:\n        """Execute web automation task"""\n        self.logger.info("Executing web automation task")\n        \n        try:\n            # Send request to Node.js service for web automation\n            node_service_url = f"http://{self.config[\'services\'][\'node_events\'][\'host\']}:{self.config[\'services\'][\'node_events\'][\'port\']}/automate"\n            \n            response = requests.post(node_service_url, json=params, timeout=30)\n            return response.json()\n        except Exception as e:\n            error_msg = f"Web automation task execution failed: {str(e)}"\n            self.logger.error(error_msg)\n            return {"error": error_msg}\n    \n    def health_check(self) -> Dict[Any, Any]:\n        """Perform system health check"""\n        self.logger.info("Performing system health check")\n        \n        health_status = {\n            "timestamp": datetime.now().isoformat(),\n            "system": "HEX-CyberSphere",\n            "status": "healthy",\n            "components": {}\n        }\n        \n        # Check each service\n        for service_name, service_config in self.config[\'services\'].items():\n            if service_config[\'enabled\']:\n                try:\n                    url = f"http://{service_config[\'host\']}:{service_config[\'port\']}/health"\n                    response = requests.get(url, timeout=5)\n                    health_status["components"][service_name] = {\n                        "status": "healthy" if response.status_code == 200 else "unhealthy",\n                        "response_time": response.elapsed.total_seconds()\n                    }\n                except Exception as e:\n                    health_status["components"][service_name] = {\n                        "status": "unhealthy",\n                        "error": str(e)\n                    }\n        \n        # Check database\n        try:\n            cursor = self.db_connection.cursor()\n            cursor.execute("SELECT 1")\n            health_status["components"]["database"] = {"status": "healthy"}\n        except Exception as e:\n            health_status["components"]["database"] = {\n                "status": "unhealthy",\n                "error": str(e)\n            }\n        \n        return health_status\n    \n    def _log_event(self, event_type: str, source: str, data: str):\n        """Log event to database"""\n        try:\n            cursor = self.db_connection.cursor()\n            cursor.execute("""\n                INSERT INTO events (event_type, source, data) \n                VALUES (?, ?, ?)\n            """, (event_type, source, data))\n            self.db_connection.commit()\n        except Exception as e:\n            self.logger.error(f"Failed to log event: {e}")\n    \n    def get_task_history(self) -> Dict[Any, Any]:\n        """Get task execution history"""\n        try:\n            cursor = self.db_connection.cursor()\n            cursor.execute("""\n                SELECT event_type, source, data, timestamp \n                FROM events \n                WHERE event_type IN (\'task_execution\', \'task_result\', \'task_error\')\n                ORDER BY timestamp DESC \n                LIMIT 100\n            """)\n            \n            rows = cursor.fetchall()\n            history = [\n                {\n                    "event_type": row[0],\n                    "source": row[1],\n                    "data": row[2],\n                    "timestamp": row[3]\n                }\n                for row in rows\n            ]\n            \n            return {"history": history}\n        except Exception as e:\n            error_msg = f"Failed to retrieve task history: {str(e)}"\n            self.logger.error(error_msg)\n            return {"error": error_msg}\n\n# Example usage\nif __name__ == "__main__":\n    manager = AutomationManager()\n    \n    # Example task execution\n    task_params = {\n        "data": {\n            "metric1": [1, 2, 3, 4, 5, 100],\n            "metric2": [10, 20, 30, 40, 50, 60]\n        },\n        "operation": "anomaly_detect"\n    }\n    \n    print("Executing AI task...")\n    result = manager.execute_task("ai_process", task_params)\n    print(json.dumps(result, indent=2))\n    \n    print("\\nPerforming health check...")\n    health = manager.health_check()\n    print(json.dumps(health, indent=2))\n</create-file>\n</function_calls>'}