{'role': 'assistant', 'content': '<function_calls>\n<create-file file_path="HEX-CyberSphere/node_events/websocket_server.js">\n/**\n * HEX-CyberSphere WebSocket Server\n * Dedicated WebSocket server for real-time communication\n */\n\nconst WebSocket = require(\'ws\');\nconst http = require(\'http\');\n\n// Create HTTP server\nconst server = http.createServer();\n\n// Create WebSocket server\nconst wss = new WebSocket.Server({ server });\n\n// Store active connections\nconst clients = new Set();\n\n// Handle WebSocket connections\nwss.on(\'connection\', (ws, req) => {\n  console.log(\'New WebSocket client connected\');\n  clients.add(ws);\n  \n  // Send welcome message\n  ws.send(JSON.stringify({\n    type: \'welcome\',\n    message: \'Connected to HEX-CyberSphere WebSocket Server\',\n    timestamp: new Date().toISOString()\n  }));\n  \n  // Handle incoming messages\n  ws.on(\'message\', (message) => {\n    try {\n      const data = JSON.parse(message);\n      console.log(\'Received message:\', data);\n      \n      // Process message based on type\n      switch (data.type) {\n        case \'ping\':\n          ws.send(JSON.stringify({\n            type: \'pong\',\n            timestamp: new Date().toISOString()\n          }));\n          break;\n          \n        case \'subscribe\':\n          ws.subscriptions = ws.subscriptions || new Set();\n          ws.subscriptions.add(data.channel);\n          ws.send(JSON.stringify({\n            type: \'subscribed\',\n            channel: data.channel,\n            timestamp: new Date().toISOString()\n          }));\n          break;\n          \n        case \'unsubscribe\':\n          if (ws.subscriptions) {\n            ws.subscriptions.delete(data.channel);\n          }\n          ws.send(JSON.stringify({\n            type: \'unsubscribed\',\n            channel: data.channel,\n            timestamp: new Date().toISOString()\n          }));\n          break;\n          \n        default:\n          // Broadcast to all clients\n          broadcastMessage({\n            type: \'broadcast\',\n            from: \'client\',\n            data: data,\n            timestamp: new Date().toISOString()\n          });\n      }\n    } catch (error) {\n      console.error(\'Error processing message:\', error);\n      ws.send(JSON.stringify({\n        type: \'error\',\n        message: \'Invalid message format\',\n        timestamp: new Date().toISOString()\n      }));\n    }\n  });\n  \n  // Handle connection close\n  ws.on(\'close\', () => {\n    console.log(\'WebSocket client disconnected\');\n    clients.delete(ws);\n  });\n  \n  // Handle errors\n  ws.on(\'error\', (error) => {\n    console.error(\'WebSocket error:\', error);\n  });\n});\n\n// Broadcast message to all clients\nfunction broadcastMessage(message) {\n  const messageStr = JSON.stringify(message);\n  \n  clients.forEach((client) => {\n    if (client.readyState === WebSocket.OPEN) {\n      client.send(messageStr);\n    }\n  });\n}\n\n// Send system updates periodically\nsetInterval(() => {\n  const systemUpdate = {\n    type: \'system_update\',\n    data: {\n      clients: clients.size,\n      timestamp: new Date().toISOString(),\n      uptime: process.uptime()\n    }\n  };\n  \n  broadcastMessage(systemUpdate);\n}, 10000); // Every 10 seconds\n\n// Handle HTTP requests\nserver.on(\'request\', (req, res) => {\n  if (req.url === \'/health\') {\n    res.writeHead(200, { \'Content-Type\': \'application/json\' });\n    res.end(JSON.stringify({\n      status: \'healthy\',\n      service: \'websocket_server\',\n      clients: clients.size,\n      timestamp: new Date().toISOString()\n    }));\n  } else if (req.url === \'/\') {\n    res.writeHead(200, { \'Content-Type\': \'application/json\' });\n    res.end(JSON.stringify({\n      system: \'HEX-CyberSphere WebSocket Server\',\n      version: \'1.0.0\',\n      description: \'Dedicated WebSocket server for real-time communication\'\n    }));\n  } else {\n    res.writeHead(404);\n    res.end(\'Not found\');\n  }\n});\n\n// Start server\nconst PORT = process.env.WS_PORT || 3001;\nserver.listen(PORT, () => {\n  console.log(\'╔════════════════════════════════════════════════╗\');\n  console.log(\'║              ⚡ H E X – C Y B E R S P H E R E ⚡              ║\');\n  console.log(\'╚════════════════════════════════════════════════╝\');\n  console.log(\'     WebSocket Server Started\');\n  console.log(`  Listening on port ${PORT}`);\n  console.log(\'  Real-time communication ready\');\n});\n\n// Graceful shutdown\nprocess.on(\'SIGTERM\', () => {\n  console.log(\'SIGTERM received, shutting down WebSocket server\');\n  server.close(() => {\n    console.log(\'WebSocket server closed\');\n    process.exit(0);\n  });\n});\n\nprocess.on(\'SIGINT\', () => {\n  console.log(\'SIGINT received, shutting down WebSocket server\');\n  server.close(() => {\n    console.log(\'WebSocket server closed\');\n    process.exit(0);\n  });\n});\n</create-file>\n</function_calls>'}